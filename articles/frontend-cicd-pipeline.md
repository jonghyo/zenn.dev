---
title: 'フロントエンド開発におすすめのCI/CDパイプライン'
emoji: '⚙'
type: 'tech' # tech: 技術記事 / idea: アイデア
topics: ['frontend', 'typescript', 'javascript', 'nodejs', 'githubactions']
published: false
---

## はじめに

フロントエンド開発をするときにおすすめするCI/CDパイプライン構成を紹介します。

## こんな人におすすめ!

- フロントエンド開発時にコード品質をCI/CDパイプラインで管理したい
- 複数人のチーム開発
- CI/CDパイプライン構築するけどどんな処理が必要か知りたい

## TL;DR

## 前提

この記事は以下を前提としています。

- アプリケーションフレームワーク： Next.js AppRouter
  - このパイプラインはNext.jsでなくてもJS/TSを使った、一般的なフロントエンド開発に応用可能
-
- ランタイム：Node.js v22系以降
- パッケージ管理ツール： npm
- ビルド環境： GitHub Actions
- DevSecOpsやカッチリ目の管理をしたいプロジェクト用
  - セキュリティ関連のチェックや、OSSライセンスのチェックなども行ないたい

CD(Continuous Deployment, Delivery)部分は、プロジェクトごとに差異が大きいため今回は主にCI（Continuous Integration）部分を紹介。

## CI/CDパイプラインとは

昨今のフロントエンド開発において、

**CI/CD（Continuous Integration / Continuous Deployment, Delivery）パイプラインは、コードの品質を維持しながら開発効率を向上させるために必要不可欠です。**

初歩的な話ですが、CI/CDパイプラインの役割や必要性について改めて振り返ります。

![CI/CD](/images/frontend-cicd-pipeline/what-is-ci-cd-hero.jpg)

画像引用：[CI/CD とは？開発に欠かせない理由と必要性を解説](https://circleci.com/ja/blog/what-is-ci-cd/) より

### CI/CDパイプラインの役割

CI/CDパイプラインは、開発プロセスを自動化することで、コードの統合・テスト・デプロイをスムーズに進める仕組みです。主な目的は以下の通りです。

#### CI（継続的インテグレーション）

以下のような処理を開発プロセスに組み込み継続的に回すことで、バグの早期発見やコーディングルールの遵守など品質向上に寄与します。

- **静的解析・テストの自動実行**： Lint（ESLint, Biomeなど）、 Unit test、Integration test、SASTなどを実行し、バグの早期発見やコーディングルール違反を早期に検知可能
  - ビルド用サーバーに結果レポートが出力されるため、コードレビュー時に参照可能
- **ビルドの自動実行**： ビルド用サーバーアプリケーションのビルドを自動実行することにより、コンパイルエラーが発生しているコードが含まれてないか・動かないコードが含まれていないかいち早く検知可能

#### CD（継続的デリバリー/デプロイメント）

ビルドとデプロイの自動化→ WebアプリやSPAのビルドを自動化し、本番環境やステージング環境へ反映一貫性のあるデプロイ→ 手動デプロイのミスを減らし、安定したリリースを実現

### CI/CDパイプラインが必要な理由

フロントエンド開発では、コードの変更が頻繁に発生するため、手動で統合・テスト・デプロイを行なうと以下のような問題が発生します。

1. **バグやリグレッション（後戻り）の防止**

手動テストでは見落としが発生しやすいため、自動テストをパイプラインに組み込むことで、変更のたびにコードの品質を確保できます。

2. **開発速度の向上**

手動のコードレビューやテストに頼ると、リリースまでに時間がかかります。CI/CDを導入することで、コードをプッシュするだけで自動的にテスト・ビルド・デプロイが実行され、開発サイクルが加速します。

3. **デプロイの一貫性と信頼性**

環境ごとに手動でデプロイすると設定ミスの可能性があります。CI/CDを利用すると、一貫した環境構築ができるため、予期せぬエラーを減らせます。

### CI/CDパイプラインとDevSecOps

## Git HooksとCI/CDパイプライン

![Git Hooks](/images/frontend-cicd-pipeline/git-hooks.png)

画像引用：[Git Hooks](https://www.driftingruby.com/episodes/git-hooks) より

CI/CDパイプライン以外に開発プロジェクトにおいて、バグの早期発見やコーディングルールの遵守などを行なうための仕組みとして[Git Hooks](https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA-Git-%E3%83%95%E3%83%83%E3%82%AF)があります。

### Git Hooksとは

特定のGitイベント（コミットやプッシュなど）が発生したときに自動で実行されるスクリプトです。ローカルリポジトリの.git/hooksディレクトリに配置され、例えば以下のような用途で使われます。

- pre-commit：コミット前にコードのフォーマットやLintチェックを実行
- pre-push：プッシュ前にテストを実行し、失敗したらプッシュを防ぐ
- commit-msg：コミットメッセージのフォーマットを強制する

カスタマイズが可能で、シェルスクリプトやPython、Node.jsなどで記述できます。

### Git HooksとCI/CDパイプラインの使い分け

それぞれの概要と、私が考える使い分けの方針を示します。

| 項目 | Git Hooks | CI/CD パイプライン |
| --- | --- | --- |
| **概要** | ローカルまたはリモートのGitイベント時に実行されるスクリプト | Gitのイベントをトリガーに、リモートで実行される自動化プロセス |
| **実行場所** | 開発者のローカル環境 or Gitリモートサーバー | ビルドサーバー（GitHub Actions, GitLab CI, CircleCIなど） |
| **用途** | コミット/プッシュ時のコード品質チェックや自動処理 | コード統合、テスト、ビルド、デプロイの自動化 |
| **メリット** | - 開発者の手元で即時フィードバックを得られる<br> - CI/CDの負担を軽減できる | - すべての開発者に対して統一されたチェックが可能<br> - 本番環境向けモジュールのビルドやデプロイを自動化できる |
| **デメリット** | - 開発者ごとに環境差が出る可能性がある<br> - ローカルでの実行のため強制力が弱い | - フィードバックに時間がかかる<br> - CI/CD環境のセットアップ・維持が必要 |
| **使い分けの方針** | - **ローカルで素早くチェック**したい場合（リント、フォーマット、自動修正）<br> - **個人の開発負担を減らす**用途 <br> - **Gitサーバーにpushさせたくない情報をブロック**する(e.g. シークレット情報、コミットコメントルール違反...) | - **チーム全体で統一ルールを適用**したい場合（リント、テスト、ビルド）<br> - **デプロイやステージング環境への反映を自動化**したい場合 |

### Git Hooksを実現するライブラリ

Git Hooksは`.git/hooks`配下に、コミット時(`pre-commit`)やpush時(`pre-push`)に実行したい任意の処理をshellなどで定義できます。

ただ、昨今フロントエンド開発ではGit Hooksを実現するライブラリを利用するケースが多いです。

Git Hooksを実現するためのライブラリをいくつか紹介します。

※個人的には、動作が軽快で使いやすいので[lefthook](https://github.com/evilmartians/lefthook)をおすすめします。

#### lefthook

- 概要: Golang製の高速なGit Hooksマネージャー
- 特徴:
  - Huskyよりもパフォーマンスが良い
  - 複数のコマンドを並列実行可能
  - 言語を問わず利用できる

https://github.com/evilmartians/lefthook

#### Husky + Lint-Staged

- 概要: JavaScript/TypeScriptプロジェクトで広く使われるGit hooks管理ツール
- 特徴:
  - package.jsonで簡単に設定可能
  - pre-commit, pre-pushなどを簡単に適用
  - ESLint、Prettier、テストの自動実行に適している

https://github.com/typicode/husky

https://github.com/lint-staged/lint-staged

## おすすめするCI/CDパイプライン

//TODO

- ジョブ一覧とGit Hooks, CIのどちらで実施すべきかの表。画像がよいか。

### Verify Jobs

#### Lint

#### tsc

#### knip

#### license checker

#### Unit test

#### npm audit
